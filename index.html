<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Plan de 1 Mes para Aprender Alem√°n (A1) ‚ú® - D√≠a a D√≠a</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

  <style>
    :root {
      --pink-500: #ec4899;
      --pink-200: #fbcfe8;
      --pink-50: #fdf2f8;
      --grad-from: #f472b6; 
      --grad-to: #a855f7; 
    }
    body { font-family: 'Inter', sans-serif; background: #f8fafc; }
    .font-display { font-family: 'Dancing Script', cursive; }
    .stat-card {
      background: rgba(255, 255, 255, 0.2); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.3);
    }
    .checkbox-wrap { position: relative; padding-left: 2.1rem; display: inline-flex; align-items: center; cursor: pointer; }
    .checkbox-wrap input[type="checkbox"] { position: absolute; left: 0; top: 0.12rem; width: 1.25rem; height: 1.25rem; opacity: 0; }
    .checkbox-box {
      position: absolute; left: 0; top: 0.12rem; width: 1.25rem; height: 1.25rem;
      border: 2px solid var(--pink-200); border-radius: .25rem; display: inline-flex; align-items:center; justify-content:center;
      transition: all .18s; background: white;
    }
    .checkbox-box .tick { font-size: 1rem; color: white; opacity: 0; transition: opacity .15s; line-height: 1; }
    input[type="checkbox"]:checked + .checkbox-box { background: var(--pink-500); border-color: var(--pink-500); }
    input[type="checkbox"]:checked + .checkbox-box .tick { opacity: 1; }
    .task-done { text-decoration: line-through; color: #6b7280; }
    .modal { transition: opacity .25s, transform .25s; }
    @keyframes shake {
      0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); }
    }
    .shake-anim { animation: shake 0.3s ease-in-out; }
    .nav-btn:disabled { opacity: 0.5; cursor: not-allowed; }
    
    /* Estilo para las pesta√±as de la lecci√≥n */
    .tab-button.active {
        background-color: white;
        color: var(--pink-500);
        font-weight: 600;
        border-bottom-color: white;
    }
    .tab-button {
        background-color: #f3f4f6; /* gray-100 */
        border-color: #e5e7eb; /* gray-200 */
        transition: background-color 0.15s;
        border-bottom: 2px solid var(--pink-500);
    }
    /* Estilo para el contenido de la lecci√≥n */
    .lesson-content h3 { font-size: 1.25rem; font-weight: 600; margin-top: 1rem; margin-bottom: 0.5rem; color: #a855f7; /* purple-500 */ }
    .lesson-content p { margin-bottom: 0.75rem; line-height: 1.5; }
    .lesson-content strong { font-weight: 700; color: #ec4899; }
  </style>
</head>
<body class="min-h-screen">

  <header class="bg-gradient-to-r from-[var(--grad-from)] to-[var(--grad-to)] text-white p-6 shadow-lg">
    <div class="max-w-4xl mx-auto">
      <div class="flex justify-between items-center mb-6">
        <div class="text-center flex-1">
          <h1 class="text-4xl md:text-5xl font-display">Tu Plan de Alem√°n</h1>
          <p class="text-lg opacity-90">(Nivel A1)</p>
        </div>
        <button id="openReminderModalBtn" class="p-2 rounded-full hover:bg-white/20 transition">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" d="M14.857 17.082a23.848 23.848 0 005.454-1.31A8.967 8.967 0 0118 9.75v-.7V9A6 6 0 006 9v.75a8.967 8.967 0 01-2.312 6.022c1.733.64 3.56 1.085 5.455 1.31m5.714 0a24.255 24.255 0 01-5.714 0m5.714 0a3 3 0 11-5.714 0" /></svg>
        </button>
      </div>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <div class="stat-card rounded-xl p-4 flex items-center gap-4">
          <div class="p-2 bg-white/30 rounded-lg"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" d="M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 012.25-2.25h13.5A2.25 2.25 0 0121 7.5v11.25m-18 0A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75m-18 0v-7.5A2.25 2.25 0 015.25 9h13.5A2.25 2.25 0 0121 11.25v7.5" /></svg></div>
          <div><span class="text-xs opacity-80">D√≠a del Plan</span><div id="headerDayDisplay" class="text-xl font-bold">D√≠a 1 / 30</div></div>
        </div>
        <div class="stat-card rounded-xl p-4 flex items-center gap-4">
          <div class="p-2 bg-white/30 rounded-lg"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" d="M15.362 5.214A8.252 8.252 0 0112 21 8.25 8.25 0 016.038 7.048 8.287 8.287 0 009 9.6a8.983 8.983 0 013.361-6.867 8.21 8.21 0 003 2.48z" /><path stroke-linecap="round" stroke-linejoin="round" d="M12 18a3.75 3.75 0 00.495-7.467 5.99 5.99 0 00-1.925 3.546 5.974 5.974 0 01-2.133-1A3.75 3.75 0 0012 18z" /></svg></div>
          <div><span class="text-xs opacity-80">Racha Actual</span><div id="streak" class="text-xl font-bold">0 D√≠as üî•</div></div>
        </div>
        <div class="stat-card rounded-xl p-4">
          <div class="flex justify-between items-center mb-2"><span class="text-xs opacity-80">Progreso Total</span><span id="progressPercent" class="text-xl font-bold">0%</span></div>
          <div class="w-full bg-white/30 rounded-full h-2"><div id="progressBar" class="bg-white h-2 rounded-full transition-all duration-300" style="width: 0%"></div></div>
        </div>
      </div>
    </div>
  </header>

  <div class="max-w-4xl mx-auto p-6"> 
    
    <section id="openWordOfDayCard" class="bg-white rounded-xl p-5 shadow-sm mb-6 cursor-pointer hover:shadow-lg transition">
      <h2 id="wodTitle" class="font-semibold text-gray-700 mb-3 text-sm">Wort des Tages (Palabra del D√≠a)</h2>
      <div class="flex justify-between items-end">
        <div><h3 id="wodWord" class="text-3xl font-bold text-gray-900">die Woche</h3><p id="wodPlural" class="text-sm text-gray-500 mt-1">Plural: die Wochen</p></div>
        <span id="wodTranslation" class="text-lg font-semibold text-pink-600">la semana</span>
      </div>
    </section>

    <div class="flex flex-col md:flex-row items-center justify-between gap-4 mb-4">
       <div class="flex items-center gap-3">
         <select id="jumpDay" class="rounded-md px-3 py-2 bg-white shadow-sm text-sm border border-gray-200"><option value="">Ir a d√≠a...</option></select>
         <button id="goDay" class="px-3 py-2 rounded-md bg-pink-100 text-pink-700 text-sm">Ir</button>
       </div>
       <button id="resetProgress" class="px-3 py-2 rounded-md bg-white shadow-sm text-sm text-red-600 border border-gray-200">Reset progreso</button>
    </div>

    <div class="flex justify-between items-center mb-4 p-3 bg-white rounded-lg shadow-sm border border-gray-200">
      <button id="prevDayBtn" class="nav-btn px-4 py-2 rounded-md bg-gray-100 hover:bg-gray-200 text-sm">&lt; D√≠a Anterior</button>
      <div id="currentDayDisplay" class="text-lg font-semibold text-pink-600 text-center">D√≠a X / 30</div>
      <button id="nextDayBtn" class="nav-btn px-4 py-2 rounded-md bg-gray-100 hover:bg-gray-200 text-sm">D√≠a Siguiente &gt;</button>
    </div>

    <main id="daysContainer" class="mb-8"></main> 
    
    <section class="bg-white rounded-2xl p-4 shadow-sm border border-gray-200">
      <div class="flex items-center justify-between mb-3">
        <h2 class="font-semibold text-lg text-pink-600">üìù Diario (D√≠a <span id="journalCurrentDay">1</span>)</h2>
        <div class="flex items-center gap-2"><label for="journalDay" class="text-sm text-gray-600">Seleccionar d√≠a:</label><select id="journalDay" class="rounded-md px-2 py-1 bg-gray-50 border border-gray-200"></select></div>
      </div>
      <textarea id="journalText" rows="6" class="journal-textarea w-full p-3 rounded-md border border-gray-200 bg-white" placeholder="Escribe tus frases..."></textarea>
      <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-3 mt-3">
        <p id="autosaveNotice" class="text-xs text-gray-500">Guardado autom√°tico activo.</p>
        <div class="flex gap-2 justify-end w-full sm:w-auto">
          <button id="saveJournal" class="px-3 py-2 rounded-md bg-pink-600 text-white text-sm">Guardar</button>
          <button id="exportState" class="px-3 py-2 rounded-md bg-white text-sm shadow-sm border border-gray-200">Exportar</button>
          <button id="importStateBtn" class="px-3 py-2 rounded-md bg-white text-sm shadow-sm border border-gray-200">Importar</button>
          <input id="importFile" type="file" accept="application/json" class="hidden">
        </div>
      </div>
    </section>
  </div>

  <div id="modalBackdrop" class="fixed inset-0 bg-black/40 hidden items-center justify-center z-40">
    <div id="modal" class="modal bg-white rounded-2xl p-6 max-w-lg w-full shadow-lg transform">
      <h3 id="modalTitle" class="text-xl font-semibold text-pink-600 mb-2"></h3>
      
      <div id="quizView" class="hidden">
        <p id="quizQuestion" class="text-gray-700 mb-4 text-lg">¬øC√≥mo se dice...? <strong id="quizWordTrans"></strong></p>
        <input id="quizInput" type="text" class="w-full p-2 border border-gray-300 rounded-md mb-3" placeholder="Escribe en alem√°n...">
        <div id="quizFeedback" class="text-sm text-red-500 mb-3 h-4"></div>
        <div class="flex justify-between"><button id="revealAnswerBtn" class="px-3 py-2 rounded-md bg-gray-100 text-sm">Revelar</button><button id="checkAnswerBtn" class="px-4 py-2 rounded-md bg-pink-600 text-white">Comprobar</button></div>
      </div>
      
      <div id="answerView" class="hidden">
        <p id="modalMessage" class="text-gray-700 mb-4"></p>
        <div class="mb-4 p-3 bg-gray-50 rounded-md border border-gray-200"><p class="text-sm text-gray-600 font-medium">Ejemplo:</p><p id="modalExampleSentence" class="text-sm text-gray-800 italic"></p><p id="modalExampleTranslation" class="text-xs text-gray-500 italic mt-1"></p></div>
        <div id="modalExample" class="text-sm text-gray-500 mb-4"></div> 
        <div class="flex justify-between items-center flex-wrap gap-2">
          <div class="flex gap-2"><button id="listenWordBtn" class="px-3 py-2 rounded-md bg-blue-100 text-blue-700 text-sm">üó£Ô∏è Palabra</button><button id="listenExampleBtn" class="px-3 py-2 rounded-md bg-blue-100 text-blue-700 text-sm">üó£Ô∏è Ejemplo</button></div>
          <div class="flex gap-2 flex-wrap"><button id="prevWord" class="px-3 py-2 rounded-md bg-gray-100 text-sm">Anterior</button><button id="nextWord" class="px-3 py-2 rounded-md bg-gray-100 text-sm">Siguiente</button><button id="closeModal" class="px-4 py-2 rounded-md bg-pink-600 text-white text-sm">Cerrar</button></div>
        </div>
      </div>
      
      <div id="greetingView" class="hidden">
         <p id="greetingMessage" class="text-gray-700 mb-4 text-lg"></p><button id="closeGreetingBtn" class="w-full px-4 py-2 rounded-md bg-pink-600 text-white">¬°Vamos!</button>
      </div>

      <div id="reminderView" class="hidden">
        <p class="text-gray-700 mb-4 text-sm">Crea una nota r√°pida o un recordatorio (solo local):</p>
        <textarea id="reminderInput" rows="3" class="w-full p-2 border border-gray-300 rounded-md mb-3" placeholder="Ej: Repasar los art√≠culos del D√çA 9 ma√±ana"></textarea>
        <button id="addReminderBtn" class="px-3 py-2 rounded-md bg-pink-600 text-white text-sm mb-4 w-full font-medium hover:bg-pink-700 transition">A√±adir Nota</button>
        <h4 class="font-semibold text-gray-700 mb-2 border-t pt-3">Mis Notas:</h4>
        <ul id="reminderList" class="space-y-2 max-h-40 overflow-y-auto pr-1">
          <li class="text-gray-500 italic text-sm">No hay notas guardadas.</li>
        </ul>
        <button id="closeReminderModal" class="mt-4 w-full px-4 py-2 rounded-md bg-gray-200 text-gray-700 text-sm hover:bg-gray-300 transition">Cerrar</button>
      </div>

    </div>
  </div>

  <template id="day-template">
    <article class="bg-white rounded-2xl p-4 shadow-sm border border-gray-200">
      <header class="flex flex-col md:flex-row items-start md:items-center justify-between">
        <div>
          <h3 class="text-lg font-semibold text-pink-600 day-title">üìÖ D√≠a X: T√≠tulo</h3>
          <p class="text-xs text-gray-500 day-word">Palabra clave: <strong>palabra</strong></p>
        </div>
        <div class="flex items-center gap-2 mt-2 md:mt-0">
          <div class="text-sm text-gray-600 mr-2 day-status"></div>
        </div>
      </header>
      
      <div class="mt-3 border-b border-gray-200">
        <div class="flex">
            <button data-tab="lesson" class="tab-button px-4 py-2 text-sm text-gray-600 rounded-t-lg border border-b-0 border-gray-200 -mb-px active">
                Clase del D√≠a üìñ
            </button>
            <button data-tab="tasks" class="tab-button px-4 py-2 text-sm text-gray-600 rounded-t-lg border border-b-0 border-gray-200 -mb-px ml-1">
                Pr√°ctica y Tareas ‚úÖ
            </button>
        </div>
      </div>

      <div class="tab-content lesson-tab pt-4 lesson-content">
          </div>
      
      <div class="tab-content tasks-tab pt-4 hidden">
        <div class="day-content open">
            <ul class="space-y-2 task-list"></ul>
            <button class="mt-3 px-3 py-2 bg-pink-100 text-pink-700 rounded-md text-sm journal-focus-btn">Escribir en el diario de este d√≠a</button>
        </div>
      </div>

    </article>
  </template>
  <template id="task-template">
    <li class="flex items-start gap-3 p-3 rounded-lg task-item">
      <label class="checkbox-wrap w-full">
        <input type="checkbox" class="task-checkbox">
        <span class="checkbox-box"><span class="tick">‚úì</span></span>
        <span class="ml-3 text-sm task-label">
          <span class="task-icon">üß†</span>
          <span class="task-desc">Descripci√≥n de la tarea</span>
          <span class="text-xs text-gray-500 task-time">(20 min)</span>
        </span>
      </label>
    </li>
  </template>

  <script>
    (function() {

      // PLAN_DIARIO (ACTUALIZADO con lessonContent)
      const PLAN_DIARIO = [
        { day: 1, word: 'Hallo', wordTrans: 'Hola', plural: 'Hallo', title: 'Saludos y Presentaciones', journalPrompt: 'Escribe 3 frases present√°ndote.', exampleSentence: 'Hallo, wie geht es Ihnen?', exampleTranslation: 'Hola, ¬øc√≥mo est√° usted?', learningGoals: ["Saludar y despedirse formal e informalmente.", "Presentarse (nombre).", "Preguntar '¬øC√≥mo est√°s?' y responder."], lessonContent: `
            <h3>Saludos B√°sicos (Gr√º√üe)</h3>
            <p>La forma m√°s com√∫n y vers√°til de saludar es <strong>Hallo</strong> (Hola). Para ser m√°s espec√≠fico con el tiempo del d√≠a:</p>
            <ul>
                <li><strong>Guten Morgen!</strong> (Buenos d√≠as - hasta el mediod√≠a)</li>
                <li><strong>Guten Tag!</strong> (Buen d√≠a - de mediod√≠a a tarde, el m√°s neutral)</li>
                <li><strong>Guten Abend!</strong> (Buenas tardes/noches - a partir de las 6 PM)</li>
            </ul>
            <h3>Presentaciones y Formas de Cortes√≠a</h3>
            <p>En alem√°n, la cortes√≠a es clave. Usamos <strong>Sie</strong> (Usted, formal) y <strong>du</strong> (t√∫, informal).</p>
            <p>Para preguntar el nombre:</p>
            <ul>
                <li>Formal: <strong>Wie hei√üen Sie?</strong> (¬øC√≥mo se llama Usted?)</li>
                <li>Informal: <strong>Wie hei√üt du?</strong> (¬øC√≥mo te llamas t√∫?)</li>
            </ul>
            <p>Para responder: <strong>Ich hei√üe [Tu Nombre].</strong> (Yo me llamo [Tu Nombre]).</p>
        `, tasks: [ { id:'d1-t1', icon:'üß†', color:'bg-pink-50', desc:'Vocabulario: Aprende 5 saludos y 3 despedidas.', time:'20 min' }, { id:'d1-t2', icon:'üéß', color:'bg-purple-50', desc:'Escucha un di√°logo "Hallo, wie geht\'s?" y repite.', time:'15 min' }, { id:'d1-t3', icon:'‚úçÔ∏è', color:'bg-yellow-50', desc:'Escribe 3 mini-di√°logos present√°ndote.', time:'15 min' } ] },
        
        { day: 2, word: 'die Woche', wordTrans: 'la semana', plural: 'die Wochen', title: 'Formal (Sie) vs. Informal (du)', journalPrompt: 'Escribe 2 frases formales y 2 informales.', exampleSentence: 'Diese Woche habe ich viel Arbeit.', exampleTranslation: 'Esta semana tengo mucho trabajo.', learningGoals: ["Diferenciar entre tratamiento formal (Sie) e informal (du).", "Usar las formas correctas al preguntar el nombre."], lessonContent: `
            <h3>El Dilema Sie vs. Du</h3>
            <p>La elecci√≥n entre <strong>Sie (Usted)</strong> y <strong>du (t√∫)</strong> es crucial en Alemania. El error m√°s com√∫n de los principiantes es usar "du" con desconocidos o personas mayores.</p>
            <ul>
                <li><strong>Sie:</strong> Se usa con desconocidos, clientes, jefes, profesores y personas mayores (salvo que ellos te ofrezcan usar "du"). Siempre va con may√∫scula inicial.</li>
                <li><strong>du:</strong> Se usa con amigos, familia, ni√±os y adolescentes, o si te lo han ofrecido expl√≠citamente ("Wir k√∂nnen uns duzen" / "Podemos tutearnos").</li>
            </ul>
            <h3>La Palabra del D√≠a: die Woche</h3>
            <p>La palabra <strong>die Woche</strong> (la semana) es femenina, por lo que usa el art√≠culo femenino <strong>die</strong>. Su plural es <strong>die Wochen</strong>.</p>
            <p>Aprender la palabra con el art√≠culo es vital: <strong>die Woche, die Wochen</strong>.</p>
        `, tasks: [ { id:'d2-t1', icon:'üß†', color:'bg-pink-50', desc:'Gram√°tica: Entiende la diferencia entre "Sie" (formal) y "du" (informal).', time:'15 min' }, { id:'d2-t2', icon:'üìñ', color:'bg-yellow-50', desc:'Lee ejemplos de "Wie hei√üen Sie?" vs. "Wie hei√üt du?".', time:'15 min' }, { id:'d2-t3', icon:'üó£Ô∏è', color:'bg-orange-50', desc:'Practica presentarte de ambas formas en voz alta.', time:'15 min' } ] },
        
        { day: 3, word: 'sein', wordTrans: 'ser/estar', title: 'El Verbo "sein" (Ser/Estar)', journalPrompt: 'Escribe una frase con cada conjugaci√≥n de "sein".', exampleSentence: 'Ich bin m√ºde.', exampleTranslation: 'Estoy cansado/a.', learningGoals: ["Conjugar el verbo 'sein' (ser/estar) en presente.", "Formar frases b√°sicas usando 'sein' (nacionalidad, profesi√≥n, estado)."], lessonContent: `
            <h3>El Verbo Irregular m√°s Importante: sein</h3>
            <p><strong>Sein</strong> (ser/estar) es irregular y fundamental. Debes memorizar estas conjugaciones, ya que se usa constantemente para indicar identidad, estado y ubicaci√≥n.</p>
            <div class="p-3 bg-red-50 rounded-md font-mono text-sm">
                <p>Ich <strong>bin</strong> (Yo soy/estoy)</p>
                <p>Du <strong>bist</strong> (T√∫ eres/est√°s)</p>
                <p>Er/Sie/Es <strong>ist</strong> (√âl/Ella/Ello es/est√°)</p>
                <p>Wir <strong>sind</strong> (Nosotros somos/estamos)</p>
                <p>Ihr <strong>seid</strong> (Vosotros sois/est√°is)</p>
                <p>Sie/sie <strong>sind</strong> (Usted/Ellos son/est√°n)</p>
            </div>
            <h3>Ejemplos de Uso</h3>
            <ul>
                <li>Nacionalidad: "Ich <strong>bin</strong> Spanier."</li>
                <li>Estado: "Er <strong>ist</strong> gl√ºcklich."</li>
                <li>Profesi√≥n: "Wir <strong>sind</strong> Studenten."</li>
            </ul>
        `, tasks: [ { id:'d3-t1', icon:'üß†', color:'bg-purple-50', desc:'Gram√°tica: Conjuga "sein" (ich bin, du bist, er/sie/es ist...).', time:'20 min' }, { id:'d3-t2', icon:'‚úçÔ∏è', color:'bg-yellow-50', desc:'Escribe 5 frases usando "sein" (Ej: Ich bin m√ºde, Du bist nett).', time:'20 min' }, { id:'d3-t3', icon:'üó£Ô∏è', color:'bg-orange-50', desc:'Di las conjugaciones de "sein" en voz alta 10 veces.', time:'10 min' } ] },
        
        { day: 4, word: 'haben', wordTrans: 'tener', title: 'El Verbo "haben" (Tener)', journalPrompt: 'Escribe 5 cosas que tienes.', exampleSentence: 'Wir haben Hunger.', exampleTranslation: 'Tenemos hambre.', learningGoals: ["Conjugar el verbo 'haben' (tener) en presente.", "Formar frases b√°sicas usando 'haben' (posesi√≥n, edad, sensaciones)."], lessonContent: `
            <h3>Conjugando el Verbo: haben</h3>
            <p><strong>Haben</strong> (tener) tambi√©n es irregular, pero se usa para posesi√≥n y algunas expresiones de estado (como tener hambre o sed).</p>
            <div class="p-3 bg-red-50 rounded-md font-mono text-sm">
                <p>Ich <strong>habe</strong> (Yo tengo)</p>
                <p>Du <strong>hast</strong> (T√∫ tienes)</p>
                <p>Er/Sie/Es <strong>hat</strong> (√âl/Ella/Ello tiene)</p>
                <p>Wir <strong>haben</strong> (Nosotros tenemos)</p>
                <p>Ihr <strong>habt</strong> (Vosotros ten√©is)</p>
                <p>Sie/sie <strong>haben</strong> (Usted/Ellos tienen)</p>
            </div>
            <h3>Importante: haben vs. sein</h3>
            <p>En alem√°n, las sensaciones (hambre, sed, sue√±o) se expresan con <strong>haben</strong> (tener), no con <strong>sein</strong> (estar), a diferencia del espa√±ol.</p>
            <ul>
                <li>Tener hambre: Ich <strong>habe</strong> Hunger.</li>
                <li>Tener 30 a√±os: Er <strong>hat</strong> drei√üig Jahre.</li>
            </ul>
        `, tasks: [ { id:'d4-t1', icon:'üß†', color:'bg-purple-50', desc:'Gram√°tica: Conjuga "haben" (ich habe, du hast, er/sie/es hat...).', time:'20 min' }, { id:'d4-t2', icon:'‚úçÔ∏è', color:'bg-yellow-50', desc:'Escribe 5 frases con "haben" (Ej: Ich habe einen Hund, Du hast Hunger).', time:'20 min' }, { id:'d4-t3', icon:'üéß', color:'bg-pink-50', desc:'Escucha un audio que use "sein" y "haben".', time:'15 min' } ] },
        
        { day: 5, word: 'Woher?', wordTrans: '¬øDe d√≥nde?', title: 'Preguntas (W-Fragen)', journalPrompt: 'Escribe 3 preguntas W y sus respuestas.', exampleSentence: 'Woher kommen Sie?', exampleTranslation: '¬øDe d√≥nde viene usted?', learningGoals: ["Identificar y usar las principales part√≠culas interrogativas (Wer, Was, Wo, Wie, Wann, Woher, etc.).", "Formular preguntas b√°sicas sobre informaci√≥n personal."], lessonContent: `
            <h3>Las Part√≠culas Interrogativas (W-Fragen)</h3>
            <p>Las preguntas que no se responden con s√≠/no (como las de informaci√≥n personal) comienzan con una 'W'.</p>
            <ul>
                <li><strong>Wer?</strong> (¬øQui√©n?) Ejemplo: Wer ist das?</li>
                <li><strong>Was?</strong> (¬øQu√©?) Ejemplo: Was machen Sie?</li>
                <li><strong>Wo?</strong> (¬øD√≥nde?) Ejemplo: Wo wohnst du?</li>
                <li><strong>Woher?</strong> (¬øDe d√≥nde?) Ejemplo: Woher kommen Sie?</li>
                <li><strong>Wie?</strong> (¬øC√≥mo?) Ejemplo: Wie geht es dir?</li>
            </ul>
            <h3>Estructura Clave</h3>
            <p>La regla de oro en alem√°n es que el verbo (la acci√≥n) siempre debe ir en la <strong>segunda posici√≥n</strong> de la oraci√≥n, incluso en las preguntas con W-Fragen:</p>
            <p><strong>[W-Frage] + [Verbo conjugado] + [Sujeto/Complementos]</strong></p>
            <p>Ejemplo: <strong>Wie</strong> <strong>hei√üen</strong> Sie? / <strong>Wo</strong> <strong>ist</strong> die Toilette?</p>
        `, tasks: [ { id:'d5-t1', icon:'üß†', color:'bg-purple-50', desc:'Vocabulario: Aprende las "W-Fragen" (Wer, Was, Wo, Wie, Wann, Woher).', time:'20 min' }, { id:'d5-t2', icon:'‚úçÔ∏è', color:'bg-yellow-50', desc:'Escribe una pregunta con cada "W-Frage" (Ej: Wer bist du? Wo wohnst du?).', time:'20 min' }, { id:'d5-t3', icon:'üó£Ô∏è', color:'bg-orange-50', desc:'Practica preguntar y responder estas preguntas b√°sicas en voz alta.', time:'15 min' } ] },
        
        { day: 6, word: 'die Zahl', wordTrans: 'el N√∫mero', plural: 'die Zahlen', title: 'El Alfabeto y N√∫meros (0-20)', journalPrompt: 'Escribe tu edad y n√∫mero de tel√©fono.', exampleSentence: 'Meine Lieblingszahl ist sieben.', exampleTranslation: 'Mi n√∫mero favorito es el siete.', learningGoals: ["Reconocer y pronunciar el alfabeto alem√°n.", "Contar del 0 al 20."], lessonContent: `
            <h3>El Alfabeto Alem√°n (Das Alphabet)</h3>
            <p>El alfabeto es similar al espa√±ol, pero tiene letras con di√©resis (√Ñ, √ñ, √ú) y la eszett (√ü).</p>
            <p><strong>Puntos clave:</strong></p>
            <ul>
                <li>La letra V se pronuncia como "F" (Ej: Vater -> Fater).</li>
                <li>La letra W se pronuncia como "V" (Ej: Woche -> Voche).</li>
                <li>La letra Z se pronuncia como "Ts" (Ej: Zahl -> Tsal).</li>
            </ul>
            <h3>N√∫meros 0-20</h3>
            <p>Es esencial memorizar los n√∫meros hasta el 12. A partir del 13, se forma como en ingl√©s: [Unidad] + [diez].</p>
            <ul>
                <li><strong>11:</strong> elf, <strong>12:</strong> zw√∂lf</li>
                <li><strong>13:</strong> dreizehn, <strong>16:</strong> sechzehn (¬°Ojo! Pierde la 's')</li>
            </ul>
        `, tasks: [ { id:'d6-t1', icon:'üß†', color:'bg-purple-50', desc:'Vocabulario: Aprende los n√∫meros de 0 a 20.', time:'20 min' }, { id:'d6-t2', icon:'üéß', color:'bg-pink-50', desc:'Escucha una canci√≥n del alfabeto alem√°n y c√°ntala.', time:'15 min' }, { id:'d6-t3', icon:'üó£Ô∏è', color:'bg-orange-50', desc:'Practica decir tu n√∫mero de tel√©fono y edad.', time:'15 min' } ] },
        
        { day: 7, word: 'Repaso', wordTrans: 'Revisi√≥n', title: 'Repaso Semana 1', journalPrompt: 'Escribe un p√°rrafo present√°ndote.', exampleSentence: 'Heute machen wir einen Repaso.', exampleTranslation: 'Hoy hacemos un repaso.', learningGoals: ["Consolidar saludos, presentaciones.", "Repasar conjugaciones de 'sein' y 'haben'.", "Practicar W-Fragen y n√∫meros b√°sicos."], lessonContent: `<p>Esta semana se centr√≥ en las bases de la comunicaci√≥n: presentarse, preguntar y responder informaci√≥n personal, y los dos verbos m√°s importantes: <strong>sein</strong> (ser/estar) y <strong>haben</strong> (tener).</p><h3>Autoevaluaci√≥n R√°pida</h3><p>Intenta conjugar 'sein' y 'haben' para 'Ich', 'Du', 'Er/Sie/Es' de memoria. Si lo logras, est√°s listo para la siguiente semana.</p>`, tasks: [ { id:'d7-t1', icon:'üìñ', color:'bg-yellow-50', desc:'Lee un di√°logo corto (A1) e identifica saludos, "sein", "haben".', time:'20 min' }, { id:'d7-t2', icon:'‚úçÔ∏è', color:'bg-yellow-50', desc:'Escribe un p√°rrafo corto (3-5 frases) present√°ndote.', time:'20 min' }, { id:'d7-t3', icon:'üß†', color:'bg-purple-50', desc:'Repasa vocabulario d√≠as 1-6 con flashcards.', time:'15 min' } ] },
        // --- RESTO DE D√çAS (Sin contenido de lecci√≥n detallado, solo placeholders) ---
        // DEBES a√±adir el contenido de la lecci√≥n para cada d√≠a (lessonContent)
        { day: 8, word: 'die Familie', wordTrans: 'la Familia', plural: 'die Familien', title: 'La Familia', journalPrompt: 'Describe a tu familia.', exampleSentence: 'Meine Familie wohnt in Spanien.', exampleTranslation: 'Mi familia vive en Espa√±a.', learningGoals: ["Nombrar a los miembros b√°sicos de la familia.", "Describir relaciones familiares simples."], lessonContent: `<h3>¬°Bienvenido al d√≠a 8!</h3><p>Aqu√≠ aprender√°s el vocabulario de la familia. Recuerda siempre aprender el sustantivo junto a su art√≠culo (der/die/das).</p>`, tasks: [ { id:'d8-t1', icon:'üß†', color:'bg-purple-50', desc:'Vocabulario: Aprende los miembros de la familia.', time:'20 min' }, { id:'d8-t2', icon:'‚úçÔ∏è', color:'bg-yellow-50', desc:'Dibuja tu √°rbol geneal√≥gico y etiqueta en alem√°n.', time:'20 min' }, { id:'d8-t3', icon:'üó£Ô∏è', color:'bg-orange-50', desc:'Describe a tu familia en frases simples.', time:'15 min' } ] },
        { day: 9, word: 'der', wordTrans: 'el (masc.)', title: 'Art√≠culos: Nominativo', journalPrompt: 'Escribe 10 sustantivos con su art√≠culo.', exampleSentence: 'Der Stuhl ist alt.', exampleTranslation: 'La silla es vieja.', learningGoals: ["Identificar los 3 g√©neros gramaticales.", "Usar los art√≠culos definidos (der, die, das) en nominativo."], lessonContent: `<h3>Gram√°tica del d√≠a: El Nominativo y los Art√≠culos</h3><p>El nominativo es el caso del sujeto de la oraci√≥n. ¬°Recuerda que todos los sustantivos alemanes llevan may√∫scula inicial!</p><p>Masculino: <strong>Der</strong> Mann | Femenino: <strong>Die</strong> Frau | Neutro: <strong>Das</strong> Kind</p>`, tasks: [ { id:'d9-t1', icon:'üß†', color:'bg-purple-50', desc:'Gram√°tica: Aprende los 3 g√©neros y art√≠culos.', time:'20 min' }, { id:'d9-t2', icon:'üß†', color:'bg-purple-50', desc:'Vocabulario: Aprende 10 sustantivos CON su art√≠culo.', time:'15 min' }, { id:'d9-t3', icon:'‚úçÔ∏è', color:'bg-yellow-50', desc:'Haz una lista de 5 objetos y busca su g√©nero/art√≠culo.', time:'20 min' } ] },
        { day: 10, word: 'den', wordTrans: 'el (masc. acus.)', title: 'Art√≠culos: Akkusativ', journalPrompt: 'Escribe 5 frases en Acusativo.', exampleSentence: 'Ich sehe den Mann.', exampleTranslation: 'Veo al hombre.', learningGoals: ["Comprender el caso acusativo.", "Aplicar el cambio der -> den."], lessonContent: `<h3>El Acusativo (Objeto Directo)</h3><p>El acusativo se usa para el objeto directo de la acci√≥n. Solo el art√≠culo masculino cambia: <strong>der</strong> se convierte en <strong>den</strong>.</p><p>Ejemplo: Ich habe <strong>einen</strong> Hund (masc. indefinito) | Ich sehe <strong>den</strong> Tisch (masc. definido).</p>`, tasks: [ { id:'d10-t1', icon:'üß†', color:'bg-purple-50', desc:'Gram√°tica: Entiende el Akkusativ (objeto directo). "der" -> "den".', time:'20 min' }, { id:'d10-t2', icon:'‚úçÔ∏è', color:'bg-yellow-50', desc:'Escribe 5 frases con "haben" + objeto directo.', time:'20 min' }, { id:'d10-t3', icon:'üìñ', color:'bg-yellow-50', desc:'Completa 10 ejercicios online de Nom vs Akk.', time:'15 min' } ] },
        { day: 11, word: 'ein', wordTrans: 'un', title: 'Art√≠culos Indefinidos', journalPrompt: 'Escribe 3 frases Nom. y 3 Akk.', exampleSentence: 'Das ist ein Tisch.', exampleTranslation: 'Esto es una mesa.', learningGoals: ["Usar art√≠culos indefinidos Nom/Akk.", "Reconocer los cambios en el acusativo."], lessonContent: `<h3>Art√≠culos Indefinidos: ein/eine</h3><p>En Nominativo son: ein (masc.), eine (fem.), ein (neutro). En Acusativo: **einen** (masc.), eine (fem.), ein (neutro).</p>`, tasks: [ { id:'d11-t1', icon:'üß†', color:'bg-purple-50', desc:'Gram√°tica: Aprende \'ein\' (Nom) y \'einen\' (Akk).', time:'20 min' }, { id:'d11-t2', icon:'‚úçÔ∏è', color:'bg-yellow-50', desc:'Escribe frases: "Das ist ein..." vs. "Ich habe einen...".', time:'20 min' }, { id:'d11-t3', icon:'üó£Ô∏è', color:'bg-orange-50', desc:'Se√±ala objetos y di "Das es ein/eine...".', time:'10 min' } ] },
        { day: 12, word: 'mein', wordTrans: 'mi', title: 'Posesivos (mein, dein)', journalPrompt: 'Escribe 5 frases con posesivos.', exampleSentence: 'Mein Bruder hei√üt Peter.', exampleTranslation: 'Mi hermano se llama Peter.', learningGoals: ["Usar posesivos 'mein' y 'dein'.", "Declinar posesivos."], lessonContent: `<h3>Posesivos: mein y dein</h3><p>Los posesivos se declinan como los art√≠culos indefinidos. Si el sustantivo es femenino o plural, a√±aden '-e': mein/meine, dein/deine.</p>`, tasks: [ { id:'d12-t1', icon:'üß†', color:'bg-purple-50', desc:'Gram√°tica: Aprende "mein/meine" y "dein/deine" en Nominativo.', time:'20 min' }, { id:'d12-t2', icon:'‚úçÔ∏è', color:'bg-yellow-50', desc:'Escribe 5 frases sobre tu familia y cosas.', time:'20 min' }, { id:'d12-t3', icon:'üó£Ô∏è', color:'bg-orange-50', desc:'Describe a tu familia usando posesivos.', time:'15 min' } ] },
        { day: 13, word: 'rot', wordTrans: 'rojo', title: 'Colores y Adjetivos B√°sicos', journalPrompt: 'Describe 5 objetos.', exampleSentence: 'Das Auto ist rot.', exampleTranslation: 'El coche es rojo.', learningGoals: ["Nombrar colores.", "Usar adjetivos b√°sicos."], lessonContent: `<h3>Describiendo el mundo: Colores</h3><p>Los colores se usan como en espa√±ol, pero van sin declinaci√≥n cuando act√∫an como predicado (despu√©s del verbo sein): Das Auto ist <strong>rot</strong>.</p>`, tasks: [ { id:'d1Next-t1', icon:'üß†', color:'bg-purple-50', desc:'Vocabulario: Aprende 10 colores y 5 adjetivos.', time:'20 min' }, { id:'d13-t2', icon:'‚úçÔ∏è', color:'bg-yellow-50', desc:'Escribe 5 frases describiendo objetos.', time:'20 min' }, { id:'d13-t3', icon:'üéß', color:'bg-pink-50', desc:'Escucha "Nicos Weg" (A1) e identifica adjetivos.', time:'15 min' } ] },
        { day: 14, word: 'das Zimmer', wordTrans: 'la Habitaci√≥n', plural: 'die Zimmer', title: 'Repaso Semana 2', journalPrompt: 'Describe tu habitaci√≥n.', exampleSentence: 'Mein Zimmer ist klein.', exampleTranslation: 'Mi habitaci√≥n es peque√±a.', learningGoals: ["Consolidar art√≠culos Nom/Akk.", "Practicar vocabulario y posesivos."], lessonContent: `<h3>Repaso de Art√≠culos y Casos</h3><p>Este d√≠a es para asegurar que las declinaciones de los art√≠culos definidos e indefinidos en Nominativo y Acusativo son claras. C√©ntrate en identificar el objeto directo.</p>`, tasks: [ { id:'d14-t1', icon:'üß†', color:'bg-purple-50', desc:'Gram√°tica: Haz un mapa mental de Nom vs Akk.', time:'15 min' }, { id:'d14-t2', icon:'‚úçÔ∏è', color:'bg-yellow-50', desc:'Escribe un p√°rrafo describiendo tu habitaci√≥n.', time:'25 min' }, { id:'d14-t3', icon:'üìñ', color:'bg-yellow-50', desc:'Lee un texto A1 sobre una familia.', time:'15 min' } ] },
        { day: 15, word: 'lernen', wordTrans: 'aprender', title: 'Verbos Regulares', journalPrompt: 'Conjuga "lernen".', exampleSentence: 'Ich lerne Deutsch.', exampleTranslation: 'Aprendo alem√°n.', learningGoals: ["Conjugar verbos regulares.", "Usar la terminaci√≥n correcta seg√∫n el pronombre."], lessonContent: `<h3>La Regla de la Terminaci√≥n -en</h3><p>La mayor√≠a de verbos terminan en -en. Para conjugar, quita '-en' y a√±ade las terminaciones: -e, -st, -t, -en, -t, -en.</p>`, tasks: [ { id:'d15-t1', icon:'üß†', color:'bg-purple-50', desc:'Gram√°tica: Aprende la conjugaci√≥n regular.', time:'20 min' }, { id:'d15-t2', icon:'‚úçÔ∏è', color:'bg-yellow-50', desc:'Conjuga 5 verbos regulares (Ej: Ich lerne, Du machst).', time:'20 min' }, { id:'d15-t3', icon:'üó£Ô∏è', color:'bg-orange-50', desc:'Practica decir 10 frases con verbos regulares.', time:'15 min' } ] },
        { day: 16, word: 'fahren', wordTrans: 'conducir/ir', title: 'Verbos Irregulares (con cambio vocal)', journalPrompt: 'Escribe 3 frases con verbos irregulares.', exampleSentence: 'Er f√§hrt zur Arbeit.', exampleTranslation: '√âl conduce al trabajo.', learningGoals: ["Reconocer y conjugar verbos irregulares con cambio de vocal (a->√§, e->i/ie)."], lessonContent: `<h3>Verbos Irregulares (Mutaci√≥n Voc√°lica)</h3><p>Muchos verbos en alem√°n cambian su vocal en la 2¬™ y 3¬™ persona del singular (du/er/sie/es). Ejemplo: <strong>fahren</strong> (a -> √§): ich fahre, du f√§hrst, er/sie/es f√§hrt.</p>`, tasks: [ { id:'d16-t1', icon:'üß†', color:'bg-purple-50', desc:'Gram√°tica: Aprende los verbos "fahren" y "sehen" (e->ie).', time:'20 min' }, { id:'d16-t2', icon:'‚úçÔ∏è', color:'bg-yellow-50', desc:'Escribe 3 frases con "fahren" y 3 con "sehen".', time:'20 min' }, { id:'d16-t3', icon:'üìñ', color:'bg-yellow-50', desc:'Busca 3 verbos irregulares m√°s (Ej: sprechen, essen).', time:'15 min' } ] },
        { day: 17, word: 'der Bahnhof', wordTrans: 'la estaci√≥n de tren', plural: 'die Bahnh√∂fe', title: 'Preguntar y dar la hora/direcci√≥n', journalPrompt: 'Escribe un di√°logo pidiendo una direcci√≥n.', exampleSentence: 'Wo ist der Bahnhof?', exampleTranslation: '¬øD√≥nde est√° la estaci√≥n de tren?', learningGoals: ["Preguntar la hora (Wie sp√§t ist es?).", "Dar la hora formal e informalmente.", "Preguntar y dar direcciones simples."], lessonContent: `<h3>Preguntando y Dando la Hora</h3><p>Formal: <strong>Es ist [Hora] Uhr [Minutos]</strong>. Informal: Se usa "vor" (antes de) y "nach" (despu√©s de) y cuartos ("viertel") y medias horas ("halb"). Ojo: <strong>halb drei</strong> es 2:30.</p>`, tasks: [ { id:'d17-t1', icon:'üß†', color:'bg-purple-50', desc:'Vocabulario: Aprende a decir la hora (formal/informal).', time:'20 min' }, { id:'d17-t2', icon:'‚úçÔ∏è', color:'bg-yellow-50', desc:'Dibuja un mapa y escribe 3 direcciones simples (geradeaus, links, rechts).', time:'20 min' }, { id:'d17-t3', icon:'üó£Ô∏è', color:'bg-orange-50', desc:'Practica decir 5 horas diferentes.', time:'15 min' } ] },
        { day: 18, word: 'das Brot', wordTrans: 'el pan', plural: 'die Brote', title: 'Comida y Bebida', journalPrompt: 'Escribe tu lista de la compra.', exampleSentence: 'Ich kaufe das Brot.', exampleTranslation: 'Compro el pan.', learningGoals: ["Nombrar comidas y bebidas b√°sicas.", "Hacer un pedido simple en un restaurante."], lessonContent: `<h3>Comida y Pedidos (Bestellungen)</h3><p>Cuando pides comida, puedes usar "Ich m√∂chte..." (Yo quisiera...) o "Ich nehme..." (Yo tomo...). Recuerda los art√≠culos: der K√§se, die Butter, das Brot.</p>`, tasks: [ { id:'d18-t1', icon:'üß†', color:'bg-purple-50', desc:'Vocabulario: Aprende 10 alimentos y 5 bebidas.', time:'20 min' }, { id:'d18-t2', icon:'‚úçÔ∏è', color:'bg-yellow-50', desc:'Escribe un di√°logo pidiendo comida y bebida.', time:'20 min' }, { id:'d18-t3', icon:'üéß', color:'bg-pink-50', desc:'Escucha un audio sobre compras o un restaurante.', time:'15 min' } ] },
        { day: 19, word: 'gern', wordTrans: 'con gusto', title: 'Gustos y Aficiones', journalPrompt: 'Escribe 5 cosas que te gustan hacer.', exampleSentence: 'Ich lese gern B√ºcher.', exampleTranslation: 'Me gusta leer libros.', learningGoals: ["Expresar gustos y aficiones usando 'gern'.", "Nombrar actividades de ocio."], lessonContent: `<h3>Expresando Gustos con 'gern'</h3><p>En alem√°n no se usa un verbo especial para "gustar" como tal. Simplemente a√±ades el adverbio <strong>gern</strong> (con gusto) despu√©s del verbo para indicar que disfrutas de esa actividad.</p><p>Ejemplo: Ich spiele <strong>gern</strong> Fu√üball.</p>`, tasks: [ { id:'d19-t1', icon:'üß†', color:'bg-purple-50', desc:'Vocabulario: Aprende 10 verbos de actividad (lesen, schwimmen, kochen).', time:'20 min' }, { id:'d19-t2', icon:'‚úçÔ∏è', color:'bg-yellow-50', desc:'Escribe 5 frases con el patr√≥n "Ich + verbo + gern".', time:'20 min' }, { id:'d19-t3', icon:'üó£Ô∏è', color:'bg-orange-50', desc:'Pregunta a un amigo (o a ti mismo) "¬øWas machst du gern?"', time:'15 min' } ] },
        { day: 20, word: 'die E-Mail', wordTrans: 'el correo electr√≥nico', plural: 'die E-Mails', title: 'Comunicaci√≥n y Fechas', journalPrompt: 'Escribe un email corto a un amigo.', exampleSentence: 'Ich schreibe dir eine E-Mail.', exampleTranslation: 'Te escribo un correo electr√≥nico.', learningGoals: ["Escribir un email o una carta corta.", "Nombrar los d√≠as de la semana y los meses."], lessonContent: `<h3>Fechas y D√≠as (Tage und Daten)</h3><p>D√≠as de la semana (der Montag, der Dienstag...). Meses (der Januar, der Februar...). Cuando quieres decir "el lunes", usas <strong>am Montag</strong> (Preposici√≥n temporal).</p>`, tasks: [ { id:'d20-t1', icon:'üß†', color:'bg-purple-50', desc:'Vocabulario: Aprende d√≠as de la semana y meses.', time:'20 min' }, { id:'d20-t2', icon:'‚úçÔ∏è', color:'bg-yellow-50', desc:'Escribe un email de 5 frases informando sobre tu fin de semana.', time:'20 min' }, { id:'d20-t3', icon:'üéß', color:'bg-pink-50', desc:'Escucha y repite el nombre de los meses y d√≠as.', time:'15 min' } ] },
        { day: 21, word: 'Repaso', wordTrans: 'Revisi√≥n', title: 'Repaso Semana 3', journalPrompt: 'Escribe un resumen de tu rutina.', exampleSentence: 'Die Woche war lang, jetzt ist Repaso.', exampleTranslation: 'La semana fue larga, ahora es repaso.', learningGoals: ["Consolidar conjugaci√≥n regular e irregular.", "Repasar vocabulario de comida/ocio/tiempo."], lessonContent: `<h3>Verbos y Expresi√≥n de Gustos</h3><p>Aseg√∫rate de que entiendes la posici√≥n del verbo en la segunda posici√≥n (Ich <strong>spiele</strong> gern Fu√üball). Repasa los verbos con cambio voc√°lico para 'du' y 'er/sie/es'.</p>`, tasks: [ { id:'d21-t1', icon:'üß†', color:'bg-purple-50', desc:'Gram√°tica: Revisa la conjugaci√≥n de 5 verbos regulares e irregulares.', time:'20 min' }, { id:'d21-t2', icon:'‚úçÔ∏è', color:'bg-yellow-50', desc:'Escribe un texto (5-7 frases) sobre tu rutina diaria y gustos.', time:'20 min' }, { id:'d21-t3', icon:'üìñ', color:'bg-yellow-50', desc:'Haz un test online de nivel A1 de la semana 3.', time:'15 min' } ] },
        { day: 22, word: 'k√∂nnen', wordTrans: 'poder/saber', title: 'Verbos Modales (k√∂nnen, wollen)', journalPrompt: 'Escribe 3 cosas que puedes hacer y 3 que quieres.', exampleSentence: 'Ich kann Deutsch sprechen.', exampleTranslation: 'Puedo hablar alem√°n.', learningGoals: ["Usar verbos modales 'k√∂nnen' y 'wollen'.", "Entender la estructura de la oraci√≥n con verbos modales."], lessonContent: `<h3>Verbos Modales y el Verbo al Final</h3><p>Cuando usas un verbo modal, el verbo principal de la acci√≥n se va, sin conjugar (infinitivo), al **final** de la oraci√≥n.</p><p>Ejemplo: Ich <strong>kann</strong> gut Deutsch <strong>sprechen</strong>.</p>`, tasks: [ { id:'d22-t1', icon:'üß†', color:'bg-purple-50', desc:'Gram√°tica: Aprende a conjugar "k√∂nnen" y "wollen" (irregulares).', time:'20 min' }, { id:'d22-t2', icon:'‚úçÔ∏è', color:'bg-yellow-50', desc:'Escribe 5 frases con el patr√≥n: Modal + Objeto + Infinitivo.', time:'20 min' }, { id:'d22-t3', icon:'üó£Ô∏è', color:'bg-orange-50', desc:'Practica pedir algo: "Ich will/kann...".', time:'15 min' } ] },
        { day: 23, word: 'm√ºssen', wordTrans: 'deber (obligaci√≥n)', title: 'Verbos Modales (m√ºssen, d√ºrfen)', journalPrompt: 'Escribe 3 obligaciones y 3 permisos.', exampleSentence: 'Ich muss arbeiten.', exampleTranslation: 'Debo trabajar.', learningGoals: ["Usar verbos modales 'm√ºssen' y 'd√ºrfen'.", "Distinguir entre obligaci√≥n, necesidad y permiso."], lessonContent: `<h3>Obligaci√≥n y Permiso</h3><p><strong>M√ºssen</strong> (tener que, obligaci√≥n fuerte) y <strong>d√ºrfen</strong> (tener permiso). Ambos siguen la regla del verbo principal al final.</p><p>Ejemplo: Du <strong>darfst</strong> hier nicht <strong>rauchen</strong> (No se te permite fumar aqu√≠).</p>`, tasks: [ { id:'d23-t1', icon:'üß†', color:'bg-purple-50', desc:'Gram√°tica: Aprende a conjugar "m√ºssen" y "d√ºrfen".', time:'20 min' }, { id:'d23-t2', icon:'‚úçÔ∏è', color:'bg-yellow-50', desc:'Escribe 3 prohibiciones y 3 obligaciones en alem√°n.', time:'20 min' }, { id:'d23-t3', icon:'üéß', color:'bg-pink-50', desc:'Escucha di√°logos que usen modales y anota las frases.', time:'15 min' } ] },
        { day: 24, word: 'die Wohnung', wordTrans: 'el apartamento', plural: 'die Wohnungen', title: 'Vivienda y Preposiciones de Lugar (Wo)', journalPrompt: 'Describe tu apartamento usando preposiciones.', exampleSentence: 'Die K√ºche ist in der Wohnung.', exampleTranslation: 'La cocina est√° en el apartamento.', learningGoals: ["Nombrar habitaciones y muebles.", "Usar preposiciones de lugar (in, auf, unter) con Dativ."], lessonContent: `<h3>Wo (D√≥nde) y el Caso Dativo</h3><p>Cuando preguntas <strong>Wo?</strong> (D√≥nde?), la preposici√≥n de lugar (in, auf, unter, etc.) activa el caso **Dativo**.</p><p>Ejemplo: Die Lampe ist <strong>auf dem Tisch</strong> (auf + Dativo masculino: der -> dem).</p>`, tasks: [ { id:'d24-t1', icon:'üß†', color:'bg-purple-50', desc:'Vocabulario: Aprende 10 palabras de muebles y habitaciones.', time:'20 min' }, { id:'d24-t2', icon:'‚úçÔ∏è', color:'bg-yellow-50', desc:'Escribe 5 frases usando preposiciones de lugar (Wo? -> Dativ).', time:'20 min' }, { id:'d24-t3', icon:'üó£Ô∏è', color:'bg-orange-50', desc:'Describe la posici√≥n de 5 objetos en tu habitaci√≥n.', time:'15 min' } ] },
        { day: 25, word: 'die Reise', wordTrans: 'el viaje', plural: 'die Reisen', title: 'Viajes y Transporte', journalPrompt: 'Escribe sobre un viaje reciente o planeado.', exampleSentence: 'Ich mache eine Reise nach Berlin.', exampleTranslation: 'Hago un viaje a Berl√≠n.', learningGoals: ["Nombrar tipos de transporte.", "Hablar de planes de viaje simples.", "Usar preposiciones de movimiento (Wohin)."], lessonContent: `<h3>Wohin (A d√≥nde) y el Caso Acusativo</h3><p>Cuando preguntas <strong>Wohin?</strong> (¬øA d√≥nde?), la preposici√≥n de lugar activa el caso **Acusativo**.</p><p>Ejemplo: Ich gehe <strong>in die K√ºche</strong> (in + Acusativo femenino: die -> die).</p>`, tasks: [ { id:'d25-t1', icon:'üß†', color:'bg-purple-50', desc:'Vocabulario: Aprende 5 tipos de transporte.', time:'20 min' }, { id:'d25-t2', icon:'‚úçÔ∏è', color:'bg-yellow-50', desc:'Escribe 5 frases con el patr√≥n: Verbo de movimiento + Preposici√≥n + Acusativo.', time:'20 min' }, { id:'d25-t3', icon:'üéß', color:'bg-pink-50', desc:'Escucha audios sobre anuncios de trenes/vuelos.', time:'15 min' } ] },
        { day: 26, word: 'das Wetter', wordTrans: 'el clima', plural: 'das Wetter', title: 'Clima y Estaciones', journalPrompt: 'Describe el clima de hoy y de tu pa√≠s.', exampleSentence: 'Das Wetter ist heute sch√∂n.', exampleTranslation: 'El clima es lindo hoy.', learningGoals: ["Nombrar las estaciones y el clima b√°sico.", "Hacer preguntas sobre el clima."], lessonContent: `<h3>Hablando del Clima</h3><p>Para hablar del clima, se usa a menudo el sujeto impersonal <strong>Es</strong> (ello).</p><p>Ejemplo: <strong>Es</strong> regnet (Llueve). <strong>Es</strong> ist kalt (Hace fr√≠o).</p>`, tasks: [ { id:'d26-t1', icon:'üß†', color:'bg-purple-50', desc:'Vocabulario: Aprende las 4 estaciones y 10 palabras de clima.', time:'20 min' }, { id:'d26-t2', icon:'‚úçÔ∏è', color:'bg-yellow-50', desc:'Escribe 5 frases sobre el clima de las estaciones (Ej: Im Winter ist es kalt).', time:'20 min' }, { id:'d26-t3', icon:'üó£Ô∏è', color:'bg-orange-50', desc:'Practica decir el pron√≥stico del tiempo para ma√±ana.', time:'15 min' } ] },
        { day: 27, word: 'der Beruf', wordTrans: 'la profesi√≥n', plural: 'die Berufe', title: 'Profesiones y Trabajo', journalPrompt: 'Describe tu profesi√≥n y la de 2 personas m√°s.', exampleSentence: 'Ich bin Student.', exampleTranslation: 'Soy estudiante.', learningGoals: ["Nombrar profesiones comunes.", "Preguntar y responder sobre el trabajo (Was machst du beruflich?)."], lessonContent: `<h3>Las Profesiones</h3><p>En alem√°n, las profesiones tienen forma masculina y femenina. Ejemplo: der Lehrer (el profesor) y die Lehrerin (la profesora).</p><p>Para preguntar: <strong>Was sind Sie von Beruf?</strong> (¬øQu√© es usted de profesi√≥n?).</p>`, tasks: [ { id:'d27-t1', icon:'üß†', color:'bg-purple-50', desc:'Vocabulario: Aprende 10 profesiones (masculinas y femeninas).', time:'20 min' }, { id:'d27-t2', icon:'‚úçÔ∏è', color:'bg-yellow-50', desc:'Escribe 5 frases sobre profesiones usando "Ich bin..." o "Er/Sie ist...".', time:'20 min' }, { id:'d27-t3', icon:'üéß', color:'bg-pink-50', desc:'Escucha 5 di√°logos cortos sobre el trabajo.', time:'15 min' } ] },
        { day: 28, word: 'weil', wordTrans: 'porque', title: 'Conjunciones Subordinantes (weil)', journalPrompt: 'Escribe 3 frases usando "weil".', exampleSentence: 'Ich lerne Deutsch, weil es interessant ist.', exampleTranslation: 'Aprendo alem√°n porque es interesante.', learningGoals: ["Usar la conjunci√≥n 'weil'.", "Dominar la estructura subordinada (verbo al final)."], lessonContent: `<h3>La Regla del Verbo al Final con 'weil'</h3><p>Las conjunciones subordinantes como <strong>weil</strong> (porque) env√≠an el verbo conjugado al **final** de la oraci√≥n subordinada.</p><p>Ejemplo: Ich gehe nach Hause, <strong>weil ich m√ºde bin</strong>.</p>`, tasks: [ { id:'d28-t1', icon:'üß†', color:'bg-purple-50', desc:'Gram√°tica: Aprende la regla: weil + sujeto + complementos + verbo (al final).', time:'20 min' }, { id:'d28-t2', icon:'‚úçÔ∏è', color:'bg-yellow-50', desc:'Escribe 5 frases que expliquen por qu√© haces algo (Ej: Ich esse, weil ich Hunger habe).', time:'20 min' }, { id:'d28-t3', icon:'üó£Ô∏è', color:'bg-orange-50', desc:'Practica decir las frases del diario en voz alta.', time:'15 min' } ] },
        { day: 29, word: 'Pr√ºfung', wordTrans: 'examen', title: 'Simulaci√≥n de Examen A1', journalPrompt: 'Escribe 5 preguntas y respuestas t√≠picas de un examen A1.', exampleSentence: 'Ich mache heute die Pr√ºfung.', exampleTranslation: 'Hago el examen hoy.', learningGoals: ["Practicar todos los temas de la gram√°tica A1.", "Prepararse para los formatos de preguntas de ex√°menes reales (Goethe/Telc)."], lessonContent: `<h3>Consejos para la Prueba A1</h3><p>Conc√©ntrate en el formato: 1. Comprensi√≥n Lectora/Auditiva (identificar info clave), 2. Gram√°tica/Vocabulario (art√≠culos, verbos, preposiciones), 3. Expresi√≥n Escrita/Oral (presentaci√≥n personal, rellenar formularios).</p>`, tasks: [ { id:'d29-t1', icon:'üìñ', color:'bg-yellow-50', desc:'Lectura: Haz un modelo de examen de lectura A1.', time:'30 min' }, { id:'d29-t2', icon:'üéß', color:'bg-pink-50', desc:'Auditiva: Haz un modelo de examen de audici√≥n A1.', time:'30 min' }, { id:'d29-t3', icon:'üó£Ô∏è', color:'bg-orange-50', desc:'Oral: Prep√°rate para presentarte y hablar de 3 temas (familia, hobby, trabajo).', time:'20 min' } ] },
        { day: 30, word: 'Tsch√ºss', wordTrans: 'Adi√≥s', plural: 'Tsch√ºss', title: '¬°Felicidades! Nivel A1 Terminado', journalPrompt: 'Escribe un plan de estudio para el nivel A2.', exampleSentence: 'Tsch√ºss, bis bald!', exampleTranslation: 'Adi√≥s, ¬°hasta pronto!', learningGoals: ["Reconocer el progreso hecho.", "Planificar los siguientes pasos de aprendizaje (A2)."], lessonContent: `<h3>¬°Felicidades!</h3><p>Has completado el plan de 30 d√≠as. Tu progreso en el Nivel A1 es notable. En el nivel A2, te concentrar√°s en el **Pr√§teritum** (pasado simple), el **Dativ** y las preposiciones complejas. ¬°A seguir aprendiendo!</p>`, tasks: [ { id:'d30-t1', icon:'üß†', color:'bg-purple-50', desc:'Mentalidad: Revisa tu diario de 30 d√≠as y mira tu progreso.', time:'20 min' }, { id:'d30-t2', icon:'‚úçÔ∏è', color:'bg-yellow-50', desc:'Planifica los temas gramaticales de A2.', time:'20 min' }, { id:'d30-t3', icon:'üéâ', color:'bg-pink-50', desc:'¬°Celebra tu √©xito! Repite tus frases favoritas.', time:'10 min' } ] },
      ];

      // --- ESTADO Y ALMACENAMIENTO ---
      let state = {
        currentDay: 1,
        tasks: {}, 
        journals: {},
        reminders: [],
        lastActiveDate: null,
      };

      function loadState() {
        const savedState = localStorage.getItem('germanPlanState');
        if (savedState) {
          state = JSON.parse(savedState);
          // Migraci√≥n/Actualizaci√≥n de datos (si es necesario)
          state.tasks = state.tasks || {};
          state.journals = state.journals || {};
          state.reminders = state.reminders || [];
          state.lastActiveDate = state.lastActiveDate || null;
        }
      }

      function saveState() {
        localStorage.setItem('germanPlanState', JSON.stringify(state));
        console.log("Estado guardado autom√°ticamente.");
      }

      // --- L√ìGICA DE RACHA (STREAK) ---
      function getStreak() {
        let streak = 0;
        let currentDate = new Date();
        currentDate.setHours(0, 0, 0, 0); // Reset time to midnight
        let checkDate = new Date(currentDate);

        // Check if today's tasks are done
        const todayDayIndex = state.currentDay - 1;
        if (todayDayIndex >= 0 && PLAN_DIARIO[todayDayIndex] && areAllTasksDone(PLAN_DIARIO[todayDayIndex].tasks, todayDayIndex + 1)) {
          streak = 1;
          checkDate.setDate(checkDate.getDate() - 1); // Move to yesterday
        }

        // Check previous days
        for (let i = state.currentDay - 2; i >= 0; i--) {
            const dayData = PLAN_DIARIO[i];
            const dayNumber = i + 1;
            
            // Reconstruct the date when this day was completed
            let completionDate = null;
            // This is a simplified check: we assume a day is "completed" if all tasks are done.
            // A more robust implementation would track *when* they were completed.
            if (areAllTasksDone(dayData.tasks, dayNumber)) {
              // Simple heuristic: The day was completed on its number-th day from start, 
              // or on the day before the first task was checked today.
              // For simplicity, we just check if the tasks for day N were done before or on day N.
              
              // For a real streak logic, we need to know the *completion date* for each day.
              // Since we don't store individual task completion dates, we'll use a simplified model:
              // Streak is the number of consecutive days *ending yesterday* for which the previous day's tasks were completed.
              
              // Simplified check: If day N is completed, and it's the day before checkDate, count it.
              
              // A simple, functional streak: count how many consecutive days, ending with the previous completed day, have their tasks done.
              
              // For the sake of this simple app, we'll just check if the previous day's tasks are done, and if today's are done.
              // If Day N is completed, and Day N+1 is completed, streak = 2.
              // We'll count completed days from the start up to (and including) state.currentDay - 1.
              // If today's tasks are done, we include today.
              
              streak = dayNumber;
            } else {
              break;
            }
        }
        
        let consecutiveCompletedDays = 0;
        for (let i = 0; i < state.currentDay; i++) {
          const dayNumber = i + 1;
          const dayTasks = PLAN_DIARIO[i].tasks;
          if (areAllTasksDone(dayTasks, dayNumber)) {
            consecutiveCompletedDays++;
          } else {
            // Reset streak if a day is missed, but only up to the currently displayed day
            // This logic is complex without time-stamping, so we will use a simpler display logic:
            // STREAK = number of consecutive *completed* days leading up to today (or the last completed day).
          }
        }
        
        // This simple version will just display the longest chain of completed days from day 1 to the current day.
        
        // Final simplified streak calculation:
        let simpleStreak = 0;
        for (let i = 1; i <= state.currentDay; i++) {
            if (areAllTasksDone(PLAN_DIARIO[i-1].tasks, i)) {
                simpleStreak++;
            } else {
                // If a day is missed, the streak is broken for this simple count
                // But we don't want to reset if the tasks are just for a future day.
                // We'll check from the last day backwards.
                break;
            }
        }

        // New, more correct approach: Calculate max consecutive days finished *up to* yesterday/today.
        let maxStreak = 0;
        let currentStreak = 0;
        
        // We only care about days up to the one before the current day,
        // unless today's is complete.
        const daysToCheck = areAllTasksDone(PLAN_DIARIO[state.currentDay - 1]?.tasks, state.currentDay) ? state.currentDay : state.currentDay - 1;

        for (let i = 1; i <= daysToCheck; i++) {
            if (areAllTasksDone(PLAN_DIARIO[i-1].tasks, i)) {
                currentStreak++;
                maxStreak = Math.max(maxStreak, currentStreak);
            } else {
                currentStreak = 0;
            }
        }
        
        return maxStreak; // Returns max consecutive days finished.
      }
      
      function updateStreakDisplay() {
          const streakValue = getStreak();
          const streakDisplay = document.getElementById('streak');
          if (streakDisplay) {
             streakDisplay.textContent = `${streakValue} D√≠a${streakValue === 1 ? '' : 's'} üî•`;
          }
      }

      // --- L√ìGICA DE D√çAS Y NAVEGACI√ìN ---
      let currentlyDisplayedDay = state.currentDay; 
      
      function goToDay(dayNumber) {
        dayNumber = Math.min(Math.max(1, dayNumber), PLAN_DIARIO.length); // Clamp
        currentlyDisplayedDay = dayNumber;
        renderDay(dayNumber);
        updateNavigationButtons(dayNumber);
        updateHeaderAndProgress();
        updateJournalDaySelect(dayNumber);
        updateJournal(dayNumber);
        updateWordOfDay(dayNumber);
        saveState(); // Guardar el d√≠a actual al navegar
        window.scrollTo({ top: 0, behavior: 'smooth' });
      }

      function updateNavigationButtons(dayNumber) {
        const prevBtn = document.getElementById('prevDayBtn');
        const nextBtn = document.getElementById('nextDayBtn');
        
        if (prevBtn) prevBtn.disabled = dayNumber <= 1;
        if (nextBtn) nextBtn.disabled = dayNumber >= PLAN_DIARIO.length;
        
        const currentDayDisplay = document.getElementById('currentDayDisplay');
        if (currentDayDisplay) {
            currentDayDisplay.textContent = `D√≠a ${dayNumber} / ${PLAN_DIARIO.length}`;
        }
      }

      function updateWordOfDay(dayNumber) {
        const dayData = PLAN_DIARIO[dayNumber - 1];
        if (dayData) {
          document.getElementById('wodTitle').textContent = `Wort des Tages (Palabra del D√≠a - D√≠a ${dayNumber})`;
          document.getElementById('wodWord').textContent = dayData.word;
          document.getElementById('wodTranslation').textContent = dayData.wordTrans;
          document.getElementById('wodPlural').textContent = dayData.plural ? `Plural: ${dayData.plural}` : '';
        }
      }

      // --- L√ìGICA DE TAREAS Y PROGRESO ---
      function getDayTasksState(dayNumber) {
        const dayKey = `day-${dayNumber}`;
        if (!state.tasks[dayKey]) {
          state.tasks[dayKey] = {};
          // Initialize state based on the tasks defined in PLAN_DIARIO
          PLAN_DIARIO[dayNumber - 1].tasks.forEach(task => {
            state.tasks[dayKey][task.id] = false;
          });
        }
        return state.tasks[dayKey];
      }

      function areAllTasksDone(tasks, dayNumber) {
        const tasksState = getDayTasksState(dayNumber);
        if (tasks.length === 0) return false; // Day must have tasks to be "done"
        return tasks.every(task => tasksState[task.id] === true);
      }
      
      function getTotalProgress() {
          let totalTasks = 0;
          let completedTasks = 0;
          PLAN_DIARIO.forEach((dayData, index) => {
              const dayNumber = index + 1;
              const tasksState = getDayTasksState(dayNumber);
              dayData.tasks.forEach(task => {
                  totalTasks++;
                  if (tasksState[task.id] === true) {
                      completedTasks++;
                  }
              });
          });
          return { totalTasks, completedTasks };
      }

      function updateHeaderAndProgress() {
        const { totalTasks, completedTasks } = getTotalProgress();
        const progress = totalTasks > 0 ? Math.round((completedTasks / totalTasks) * 100) : 0;
        
        const progressPercent = document.getElementById('progressPercent');
        const progressBar = document.getElementById('progressBar');
        const headerDayDisplay = document.getElementById('headerDayDisplay');
        
        if (progressPercent) progressPercent.textContent = `${progress}%`;
        if (progressBar) progressBar.style.width = `${progress}%`;
        if (headerDayDisplay) headerDayDisplay.textContent = `D√≠a ${currentlyDisplayedDay} / ${PLAN_DIARIO.length}`;

        // L√≥gica para avanzar el d√≠a actual (state.currentDay)
        const currentDayTasks = PLAN_DIARIO[state.currentDay - 1]?.tasks;
        if (currentDayTasks && areAllTasksDone(currentDayTasks, state.currentDay) && state.currentDay < PLAN_DIARIO.length) {
          state.currentDay++; // Avanzar autom√°ticamente al siguiente d√≠a no completado
          saveState();
        }
        
        // Renderizar de nuevo el d√≠a actual si est√° siendo visualizado
        if (currentlyDisplayedDay === state.currentDay - 1 && state.currentDay > 1) {
             goToDay(state.currentDay); // Opcional: navegar al nuevo d√≠a
        }

        updateStreakDisplay();
      }

      function handleTaskChange(event, dayNumber, taskId) {
        const isChecked = event.target.checked;
        const dayKey = `day-${dayNumber}`;
        
        if (!state.tasks[dayKey]) {
          getDayTasksState(dayNumber); // Ensure initialization
        }
        
        state.tasks[dayKey][taskId] = isChecked;
        
        const listItem = event.target.closest('.task-item');
        if (listItem) {
          const taskLabel = listItem.querySelector('.task-label');
          if (taskLabel) {
            if (isChecked) {
              taskLabel.classList.add('task-done');
            } else {
              taskLabel.classList.remove('task-done');
            }
          }
        }

        updateHeaderAndProgress();
        renderDay(currentlyDisplayedDay); // Re-render para actualizar el estado de "Completado"
        saveState();

        // Confetti al terminar un d√≠a
        const dayData = PLAN_DIARIO[dayNumber - 1];
        if (areAllTasksDone(dayData.tasks, dayNumber)) {
          showConfetti();
        }
      }

      function renderTasks(dayData, dayNumber, taskListContainer) {
        taskListContainer.innerHTML = '';
        const dayTasksState = getDayTasksState(dayNumber);
        const template = document.getElementById('task-template');
        
        dayData.tasks.forEach(task => {
          const clone = template.content.cloneNode(true);
          const taskItem = clone.querySelector('.task-item');
          const checkbox = clone.querySelector('.task-checkbox');
          const taskIcon = clone.querySelector('.task-icon');
          const taskDesc = clone.querySelector('.task-desc');
          const taskTime = clone.querySelector('.task-time');
          const taskLabel = clone.querySelector('.task-label');
          
          checkbox.id = `task-${dayNumber}-${task.id}`;
          checkbox.checked = dayTasksState[task.id] === true;
          checkbox.addEventListener('change', (e) => handleTaskChange(e, dayNumber, task.id));

          taskIcon.textContent = task.icon;
          taskDesc.textContent = task.desc;
          taskTime.textContent = task.time ? `(${task.time})` : '';
          
          if (checkbox.checked) {
             taskLabel.classList.add('task-done');
          }

          taskListContainer.appendChild(clone);
        });
      }

      function renderDay(dayNumber) {
        const dayData = PLAN_DIARIO[dayNumber - 1];
        const container = document.getElementById('daysContainer');
        container.innerHTML = ''; // Limpiar contenido anterior
        
        if (!dayData) {
          container.innerHTML = `<p class="text-red-500">Error: D√≠a ${dayNumber} no encontrado.</p>`;
          return;
        }

        const template = document.getElementById('day-template');
        const clone = template.content.cloneNode(true);
        
        // Rellenar cabecera del d√≠a
        clone.querySelector('.day-title').textContent = `üìÖ D√≠a ${dayNumber}: ${dayData.title}`;
        clone.querySelector('.day-word strong').textContent = dayData.word;

        // T√≠tulo/Palabra clave
        const dayStatus = clone.querySelector('.day-status');
        if (areAllTasksDone(dayData.tasks, dayNumber)) {
           dayStatus.innerHTML = '<span class="text-green-600 font-bold">Completado üéâ</span>';
        } else {
           dayStatus.innerHTML = '<span class="text-yellow-600 font-medium">Pendiente...</span>';
        }
        
        // Rellenar contenido de la lecci√≥n
        const lessonContent = clone.querySelector('.lesson-content');
        lessonContent.innerHTML = dayData.lessonContent || '<p>Contenido de la lecci√≥n no disponible para este d√≠a.</p>';

        // Rellenar la lista de tareas
        const taskList = clone.querySelector('.task-list');
        renderTasks(dayData, dayNumber, taskList);

        // A√±adir evento al bot√≥n de diario
        const journalFocusBtn = clone.querySelector('.journal-focus-btn');
        journalFocusBtn.addEventListener('click', () => {
            updateJournalDaySelect(dayNumber);
            updateJournal(dayNumber);
            document.getElementById('journalText').focus();
            window.scrollTo({ top: document.getElementById('journalText').getBoundingClientRect().top + window.scrollY - 100, behavior: 'smooth' });
        });

        // Manejar las pesta√±as
        const dayArticle = clone.querySelector('article');
        const tabButtons = dayArticle.querySelectorAll('.tab-button');
        const lessonTab = dayArticle.querySelector('.lesson-tab');
        const tasksTab = dayArticle.querySelector('.tasks-tab');

        tabButtons.forEach(button => {
            button.addEventListener('click', (e) => {
                const targetTab = e.target.getAttribute('data-tab');
                
                // Reset active class on all buttons
                tabButtons.forEach(btn => btn.classList.remove('active'));
                
                // Set active class on clicked button
                e.target.classList.add('active');

                // Toggle content visibility
                lessonTab.classList.add('hidden');
                tasksTab.classList.add('hidden');

                if (targetTab === 'lesson') {
                    lessonTab.classList.remove('hidden');
                } else if (targetTab === 'tasks') {
                    tasksTab.classList.remove('hidden');
                }
            });
        });

        container.appendChild(clone);
      }

      // --- MODAL Y QUIZ (Wort des Tages) ---
      let currentWordIndex = 0;

      function showModal(type, dayIndex = currentlyDisplayedDay - 1) {
        const modalBackdrop = document.getElementById('modalBackdrop');
        const modal = document.getElementById('modal');
        const quizView = document.getElementById('quizView');
        const answerView = document.getElementById('answerView');
        const greetingView = document.getElementById('greetingView');
        const reminderView = document.getElementById('reminderView');
        
        if (!modalBackdrop || !modal) return;
        
        // Ocultar todas las vistas
        quizView.classList.add('hidden');
        answerView.classList.add('hidden');
        greetingView.classList.add('hidden');
        reminderView.classList.add('hidden');
        
        modalBackdrop.classList.remove('hidden');
        modalBackdrop.style.display = 'flex';
        modal.classList.remove('shake-anim'); // Reset shake

        if (type === 'quiz') {
            currentWordIndex = dayIndex;
            setupQuiz();
            quizView.classList.remove('hidden');
            document.getElementById('modalTitle').textContent = `Wort des Tages (D√≠a ${dayIndex + 1})`;
            document.getElementById('quizInput').focus();
        } else if (type === 'greeting') {
            document.getElementById('modalTitle').textContent = '¬°Bienvenido a Tu Plan de Alem√°n!';
            document.getElementById('greetingMessage').textContent = 'Est√°s a punto de empezar tu viaje A1. ¬°Mucha suerte!';
            greetingView.classList.remove('hidden');
        } else if (type === 'reminder') {
            document.getElementById('modalTitle').textContent = 'Recordatorios y Notas';
            renderReminders();
            reminderView.classList.remove('hidden');
            document.getElementById('reminderInput').focus();
        }
      }

      function setupQuiz() {
        const dayData = PLAN_DIARIO[currentWordIndex];
        if (dayData) {
          document.getElementById('quizWordTrans').textContent = dayData.wordTrans;
          document.getElementById('quizInput').value = '';
          document.getElementById('quizFeedback').textContent = '';
          document.getElementById('checkAnswerBtn').classList.remove('hidden');
          document.getElementById('revealAnswerBtn').classList.remove('hidden');
        }
      }

      function checkAnswer() {
        const dayData = PLAN_DIARIO[currentWordIndex];
        const input = document.getElementById('quizInput').value.trim();
        const feedback = document.getElementById('quizFeedback');
        
        if (!dayData || !input) {
          feedback.textContent = 'Por favor, introduce una respuesta.';
          return;
        }

        // Simplificaci√≥n: solo la palabra sin art√≠culo
        const correctWord = dayData.word.replace(/^(der|die|das)\s/i, '').trim();
        const correctFullWord = dayData.word.trim();

        if (input.toLowerCase() === correctWord.toLowerCase() || input.toLowerCase() === correctFullWord.toLowerCase()) {
          showAnswer(true);
        } else {
          feedback.textContent = '‚ùå Respuesta incorrecta. Intenta de nuevo.';
          document.getElementById('modal').classList.add('shake-anim');
          setTimeout(() => document.getElementById('modal').classList.remove('shake-anim'), 300);
        }
      }

      function showAnswer(isCorrect = false) {
        const dayData = PLAN_DIARIO[currentWordIndex];
        const quizView = document.getElementById('quizView');
        const answerView = document.getElementById('answerView');
        
        quizView.classList.add('hidden');
        answerView.classList.remove('hidden');

        document.getElementById('modalMessage').innerHTML = isCorrect 
            ? `¬°Correcto! La palabra del D√≠a ${currentWordIndex + 1} es: <strong>${dayData.word}</strong> (${dayData.wordTrans})`
            : `La palabra del D√≠a ${currentWordIndex + 1} es: <strong>${dayData.word}</strong> (${dayData.wordTrans})`;
        
        document.getElementById('modalExampleSentence').textContent = dayData.exampleSentence || 'No hay ejemplo.';
        document.getElementById('modalExampleTranslation').textContent = dayData.exampleTranslation || '';

        // Actualizar navegaci√≥n de palabras
        document.getElementById('prevWord').disabled = currentWordIndex <= 0;
        document.getElementById('nextWord').disabled = currentWordIndex >= PLAN_DIARIO.length - 1;
        
        // Bot√≥n "Cerrar"
        const closeModalBtn = document.getElementById('closeModal');
        if (closeModalBtn) closeModalBtn.focus();
      }

      function nextWord() {
        if (currentWordIndex < PLAN_DIARIO.length - 1) {
          currentWordIndex++;
          setupQuiz();
          document.getElementById('quizView').classList.remove('hidden');
          document.getElementById('answerView').classList.add('hidden');
          document.getElementById('modalTitle').textContent = `Wort des Tages (D√≠a ${currentWordIndex + 1})`;
        }
        document.getElementById('prevWord').disabled = currentWordIndex <= 0;
        document.getElementById('nextWord').disabled = currentWordIndex >= PLAN_DIARIO.length - 1;
      }

      function prevWord() {
        if (currentWordIndex > 0) {
          currentWordIndex--;
          setupQuiz();
          document.getElementById('quizView').classList.remove('hidden');
          document.getElementById('answerView').classList.add('hidden');
          document.getElementById('modalTitle').textContent = `Wort des Tages (D√≠a ${currentWordIndex + 1})`;
        }
        document.getElementById('prevWord').disabled = currentWordIndex <= 0;
        document.getElementById('nextWord').disabled = currentWordIndex >= PLAN_DIARIO.length - 1;
      }

      // --- L√ìGICA DEL DIARIO ---
      function updateJournal(dayNumber) {
        const journalTextarea = document.getElementById('journalText');
        const journalCurrentDay = document.getElementById('journalCurrentDay');
        const dayKey = `day-${dayNumber}`;
        
        if (journalTextarea && journalCurrentDay) {
            journalTextarea.value = state.journals[dayKey] || '';
            journalTextarea.placeholder = PLAN_DIARIO[dayNumber - 1]?.journalPrompt || 'Escribe tus frases...';
            journalCurrentDay.textContent = dayNumber;
        }
      }
      
      function updateJournalDaySelect(dayNumber) {
        const journalDaySelect = document.getElementById('journalDay');
        if (journalDaySelect) {
            // Rellenar las opciones si es la primera vez
            if (journalDaySelect.options.length === 0) {
                PLAN_DIARIO.forEach((dayData, index) => {
                    const option = document.createElement('option');
                    option.value = index + 1;
                    option.textContent = `D√≠a ${index + 1}: ${dayData.title}`;
                    journalDaySelect.appendChild(option);
                });
                journalDaySelect.addEventListener('change', (e) => {
                    const selectedDay = parseInt(e.target.value);
                    if (!isNaN(selectedDay)) {
                        updateJournal(selectedDay);
                    }
                });
            }
            // Seleccionar el d√≠a correcto
            journalDaySelect.value = dayNumber;
        }
      }

      function saveJournal() {
        const dayNumber = parseInt(document.getElementById('journalDay').value);
        const text = document.getElementById('journalText').value;
        const dayKey = `day-${dayNumber}`;
        
        if (!isNaN(dayNumber) && dayKey) {
            state.journals[dayKey] = text;
            saveState();
            const saveBtn = document.getElementById('saveJournal');
            saveBtn.textContent = '¬°Guardado!';
            setTimeout(() => { saveBtn.textContent = 'Guardar'; }, 1500);
        }
      }
      
      // Auto-save journal every 30 seconds
      function setupAutoSave() {
          const journalTextarea = document.getElementById('journalText');
          if (journalTextarea) {
              journalTextarea.addEventListener('input', () => {
                  // Throttle autosave or just update state for manual save
                  // For simplicity, we rely on the window.beforeunload save, 
                  // but we'll add a simple save on input to reflect state immediately.
                  const dayNumber = parseInt(document.getElementById('journalDay').value);
                  const text = journalTextarea.value;
                  const dayKey = `day-${dayNumber}`;
                  if (!isNaN(dayNumber) && dayKey) {
                      state.journals[dayKey] = text;
                  }
              });
          }
          // The main save logic is tied to beforeunload and the button click.
      }
      
      // --- IMPORTAR / EXPORTAR ---
      function exportState() {
          const json = JSON.stringify(state);
          const blob = new Blob([json], { type: 'application/json' });
          const url = URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url;
          a.download = `german_plan_state_${new Date().toISOString().slice(0, 10)}.json`;
          document.body.appendChild(a);
          a.click();
          document.body.removeChild(a);
          URL.revokeObjectURL(url);
      }
      
      function importState(file) {
          const reader = new FileReader();
          reader.onload = (e) => {
              try {
                  const importedState = JSON.parse(e.target.result);
                  // Validaci√≥n m√≠nima para asegurar que es nuestro formato
                  if (importedState && typeof importedState.currentDay === 'number' && importedState.tasks && importedState.journals) {
                      state = importedState;
                      saveState();
                      alert('¬°Progreso importado con √©xito! Recargando la aplicaci√≥n.');
                      window.location.reload();
                  } else {
                      alert('Error: El archivo importado no parece ser un archivo de estado de este plan.');
                  }
              } catch (error) {
                  alert('Error al leer el archivo: Formato JSON inv√°lido.');
              }
          };
          reader.readAsText(file);
      }
      
      // --- L√ìGICA DE RECORDATORIOS ---
      function addReminder() {
          const input = document.getElementById('reminderInput');
          const text = input.value.trim();
          if (text) {
              state.reminders.push({ id: Date.now(), text: text });
              input.value = '';
              renderReminders();
              saveState();
          }
      }
      
      function deleteReminder(id) {
          state.reminders = state.reminders.filter(r => r.id !== id);
          renderReminders();
          saveState();
      }

      function renderReminders() {
          const list = document.getElementById('reminderList');
          if (!list) return;

          list.innerHTML = '';
          
          if (state.reminders.length === 0) {
              list.innerHTML = '<li class="text-gray-500 italic text-sm">No hay notas guardadas.</li>';
              return;
          }

          state.reminders.forEach(reminder => {
              const li = document.createElement('li');
              li.className = 'flex justify-between items-start p-2 bg-gray-50 rounded-md border border-gray-200';
              li.innerHTML = `
                  <span class="text-sm text-gray-800 flex-1 pr-2">${reminder.text}</span>
                  <button data-id="${reminder.id}" class="delete-reminder-btn text-red-500 hover:text-red-700 text-xs font-medium px-1 pt-0.5">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" /></svg>
                  </button>
              `;
              list.appendChild(li);
          });
          
          list.querySelectorAll('.delete-reminder-btn').forEach(btn => {
              btn.addEventListener('click', (e) => {
                  const id = parseInt(e.currentTarget.getAttribute('data-id'));
                  deleteReminder(id);
              });
          });
      }

      // --- FUNCIONES UTILITARIAS ---
      function speakGerman(text) {
          if ('speechSynthesis' in window) {
              const utterance = new SpeechSynthesisUtterance(text);
              utterance.lang = 'de-DE'; // C√≥digo de idioma para alem√°n
              speechSynthesis.speak(utterance);
          } else {
              alert('Tu navegador no soporta la API de S√≠ntesis de Voz.');
          }
      }
      
      function showConfetti() {
          if (typeof confetti !== 'undefined') {
            confetti({
              particleCount: 100,
              spread: 70,
              origin: { y: 0.6 }
            });
          }
      }

      // --- INICIALIZACI√ìN ---
      function initializeApp() {
          loadState();
          
          // Verificar si es la primera visita
          if (localStorage.getItem('germanPlanFirstVisit') === null) {
              localStorage.setItem('germanPlanFirstVisit', 'false');
              showModal('greeting'); // Mostrar mensaje de bienvenida la primera vez
          }

          // Verificar si el d√≠a actual almacenado est√° completo
          let initialDay = state.currentDay;
          if (initialDay <= PLAN_DIARIO.length) {
             const currentDayTasks = PLAN_DIARIO[initialDay - 1]?.tasks;
             // Si el d√≠a actual est√° completo, avanzamos al siguiente d√≠a disponible
             while (initialDay <= PLAN_DIARIO.length && areAllTasksDone(currentDayTasks, initialDay)) {
                initialDay++;
             }
             // Si encontramos un d√≠a no completado, lo establecemos como el d√≠a actual
             if (initialDay <= PLAN_DIARIO.length) {
                state.currentDay = initialDay;
             }
             // Si todos los d√≠as est√°n completos, se queda en el √∫ltimo d√≠a
             if (initialDay > PLAN_DIARIO.length) {
                 state.currentDay = PLAN_DIARIO.length;
             }
          }
          currentlyDisplayedDay = state.currentDay;
          
          // L√≥gica para el "Jump Day" select
          const jumpDaySelect = document.getElementById('jumpDay');
          if (jumpDaySelect) {
              PLAN_DIARIO.forEach((dayData) => {
                  const option = document.createElement('option');
                  option.value = dayData.day;
                  option.textContent = `D√≠a ${dayData.day}: ${dayData.title}`;
                  jumpDaySelect.appendChild(option);
              });
          }
          
          // Renderizar la vista inicial
          goToDay(state.currentDay);
          setupAutoSave();

          // Configurar Event Listeners
          const prevDayBtn = document.getElementById('prevDayBtn');
          const nextDayBtn = document.getElementById('nextDayBtn');
          const goDayBtn = document.getElementById('goDay');
          const openWordOfDayCard = document.getElementById('openWordOfDayCard');
          const checkAnswerBtn = document.getElementById('checkAnswerBtn');
          const revealAnswerBtn = document.getElementById('revealAnswerBtn');
          const quizInput = document.getElementById('quizInput');
          const prevWord = document.getElementById('prevWord');
          const nextWord = document.getElementById('nextWord');
          const closeModalBtn = document.getElementById('closeModal');
          const closeGreetingBtn = document.getElementById('closeGreetingBtn');
          const modalBackdrop = document.getElementById('modalBackdrop');
          const listenWordBtn = document.getElementById('listenWordBtn');
          const listenExampleBtn = document.getElementById('listenExampleBtn');
          const resetProgressBtn = document.getElementById('resetProgress');
          const saveJournalBtn = document.getElementById('saveJournal');
          const exportStateBtn = document.getElementById('exportState');
          const importStateBtn = document.getElementById('importStateBtn');
          const importFile = document.getElementById('importFile');
          const openReminderModalBtn = document.getElementById('openReminderModalBtn');
          const addReminderBtn = document.getElementById('addReminderBtn');
          const reminderInput = document.getElementById('reminderInput');
          const closeReminderModal = document.getElementById('closeReminderModal');

          if (prevDayBtn) prevDayBtn.addEventListener('click', () => goToDay(currentlyDisplayedDay - 1));
          if (nextDayBtn) nextDayBtn.addEventListener('click', () => goToDay(currentlyDisplayedDay + 1));
          
          if (goDayBtn) goDayBtn.addEventListener('click', () => {
              const selectedDay = parseInt(document.getElementById('jumpDay').value);
              if (!isNaN(selectedDay)) { goToDay(selectedDay); }
          });
          
          if (resetProgressBtn) resetProgressBtn.addEventListener('click', () => {
              if (confirm('¬øEst√°s seguro de que quieres reiniciar TODO tu progreso (tareas, diario, d√≠a actual)? Esta acci√≥n es irreversible.')) {
                  localStorage.removeItem('germanPlanState');
                  localStorage.removeItem('germanPlanFirstVisit');
                  window.location.reload();
              }
          });

          if (saveJournalBtn) saveJournalBtn.addEventListener('click', saveJournal);
          if (exportStateBtn) exportStateBtn.addEventListener('click', exportState);
          if (importStateBtn) importStateBtn.addEventListener('click', () => { importFile.click(); });
          if (importFile) importFile.addEventListener('change', (e) => {
              if (e.target.files.length > 0) {
                  importState(e.target.files[0]);
              }
          });

          if (openWordOfDayCard) openWordOfDayCard.addEventListener('click', () => { showModal('quiz', currentlyDisplayedDay - 1); });
          if (checkAnswerBtn) checkAnswerBtn.addEventListener('click', checkAnswer);
          if (revealAnswerBtn) revealAnswerBtn.addEventListener('click', () => showAnswer(false));
          if (quizInput) quizInput.addEventListener('keypress', (e) => { if (e.key === 'Enter') { checkAnswer(); } });
          if (prevWord) prevWord.addEventListener('click', prevWord);
          if (nextWord) nextWord.addEventListener('click', nextWord);
          
          if (listenWordBtn) listenWordBtn.addEventListener('click', () => { 
              const day = PLAN_DIARIO[currentWordIndex]; 
              if (day) speakGerman(day.word); 
          });
          
          if (listenExampleBtn) listenExampleBtn.addEventListener('click', () => { 
              const day = PLAN_DIARIO[currentWordIndex]; 
              if (day) speakGerman(day.exampleSentence); 
          });
          
          if (openReminderModalBtn) openReminderModalBtn.addEventListener('click', () => { showModal('reminder', currentlyDisplayedDay - 1); });
          if (addReminderBtn) addReminderBtn.addEventListener('click', addReminder);
          if (reminderInput) reminderInput.addEventListener('keypress', (e) => { if (e.key === 'Enter') { addReminder(); } });
          if (closeReminderModal) closeReminderModal.addEventListener('click', () => { if (modalBackdrop) { modalBackdrop.classList.add('hidden'); modalBackdrop.style.display = 'none'; } });
          
          if (closeModalBtn) closeModalBtn.addEventListener('click', () => { if (modalBackdrop) { modalBackdrop.classList.add('hidden'); modalBackdrop.style.display = 'none'; } });
          if (closeGreetingBtn) closeGreetingBtn.addEventListener('click', () => { if (modalBackdrop) { modalBackdrop.classList.add('hidden'); modalBackdrop.style.display = 'none'; } });
          if (modalBackdrop) modalBackdrop.addEventListener('click', (e) => { 
            if (e.target === modalBackdrop) { 
              modalBackdrop.classList.add('hidden'); modalBackdrop.style.display = 'none'; 
            } 
          });
          window.addEventListener('beforeunload', saveState);
      }

      // --- INICIO ---
      document.addEventListener('DOMContentLoaded', initializeApp);

    })();
  </script>
</body>
</html>
